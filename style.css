/* ===============================================
   リセット & 変数
   =============================================== */
* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

:root {
    --primary: #6a9cff;
    --primary-soft: rgba(106, 156, 255, 0.1);
    --bg: #f8fafd;
    --card: #ffffff;
    --text: #333333;
    --text-light: #888888;
    --shadow: 0 4px 12px rgba(0,0,0,0.05);
    --border: #f0f0f0;
}

html, body { height: 100%; width: 100%; margin: 0; padding: 0; overflow: hidden; }

body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    background-color: var(--bg); color: var(--text);
    display: flex; flex-direction: column;
}

.hidden { display: none !important; }
.card { background: var(--card); border-radius: 20px; box-shadow: var(--shadow); border: 1px solid rgba(0,0,0,0.01); }

/* ===============================================
   ヘッダー
   =============================================== */
.app-header {
    background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(15px);
    padding: 10px 15px; text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.03);
    display: flex; flex-direction: column; align-items: center; gap: 6px; z-index: 1000;
}
.app-header h1 { margin: 0; font-size: 1.1rem; font-weight: 800; color: var(--primary); }
.location-switcher { display: flex; align-items: center; background: #f0f2f5; padding: 4px 14px; border-radius: 20px; gap: 4px; }
.location-switcher select { border: none; background: transparent; font-weight: 700; font-size: 0.85rem; outline: none; }

/* ===============================================
   メインコンテンツ
   =============================================== */
.app-main { flex: 1; overflow-y: auto; padding: 15px; padding-bottom: 120px; }
.screen { display: none; }
.screen.active { display: block; animation: fadeIn 0.2s ease-out; }
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

/* ===============================================
   カレンダー
   =============================================== */
.calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
.calendar-header h2 { margin: 0; font-size: 1.1rem; }
.month-nav-btn { background: white; border: none; width: 40px; height: 40px; border-radius: 50%; box-shadow: var(--shadow); display: flex; align-items: center; justify-content: center; color: var(--primary); }
.calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; text-align: center; }
.day-label { font-size: 0.7rem; color: var(--text-light); font-weight: 800; padding-bottom: 4px; }
.day-cell { background: var(--card); min-height: 60px; border-radius: 12px; padding: 4px; display: flex; flex-direction: column; align-items: center; box-shadow: 0 1px 3px rgba(0,0,0,0.02); }
.day-cell.today { border: 2px solid var(--primary); background: #f4f8ff; }
.day-cell.inactive { background: transparent; box-shadow: none; color: #ddd; }
.day-number { font-weight: 800; font-size: 0.9rem; margin-bottom: 2px; }
.trash-icon { width: 13px; height: 13px; border-radius: 50%; margin-top: 2px; font-size: 8px; color: white; display: flex; align-items: center; justify-content: center; font-weight: 900; }
.calendar-legend { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 20px; justify-content: center; padding: 12px; background: white; border-radius: 14px; box-shadow: var(--shadow); }
.legend-item { display: flex; align-items: center; font-size: 0.65rem; font-weight: 700; color: var(--text-light); }
.trash-color-circle { width: 8px; height: 8px; border-radius: 50%; margin-right: 4px; }

/* ===============================================
   トグリスイッチ (重要: チェックボックスを隠してトグル化)
   =============================================== */
.toggle-switch { position: relative; width: 46px; height: 26px; flex-shrink: 0; }
.toggle-switch input { opacity: 0; width: 0; height: 0; position: absolute; }
.toggle-switch label { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-color: #e0e0e0; border-radius: 26px; cursor: pointer; transition: .3s; }
.toggle-switch label:before { position: absolute; content: ""; height: 20px; width: 20px; left: 3px; bottom: 3px; background-color: white; border-radius: 50%; transition: .3s; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
.toggle-switch input:checked + label { background-color: var(--primary); }
.toggle-switch input:checked + label:before { transform: translateX(20px); }

/* 高度な管理用の小さいトグル */
.toggle-switch.small { width: 38px; height: 20px; }
.toggle-switch.small label:before { height: 14px; width: 14px; }
.toggle-switch.small input:checked + label:before { transform: translateX(18px); }

/* ===============================================
   個別回収サブタブ (重要: display制御)
   =============================================== */
.sub-tabs { display: flex; gap: 8px; margin-bottom: 15px; background: #eee; padding: 4px; border-radius: 12px; }
.sub-tab-btn { flex: 1; padding: 12px; border: none; border-radius: 10px; background: transparent; color: var(--text-light); font-weight: 700; font-size: 0.85rem; cursor: pointer; }
.sub-tab-btn.active { background: var(--card); color: var(--primary); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }

/* 非アクティブなコンテンツを強制非表示 */
.sub-tab-content { display: none !important; }
.sub-tab-content.active { display: block !important; }

/* フォーム調整 */
.input-group { padding: 20px; margin-bottom: 25px; }
.row-inputs { display: flex; gap: 15px; }
.row-inputs .col { flex: 1; }

/* リスト調整 */
.registered-list-section { margin-top: 30px; }
.list-item { display: flex; justify-content: space-between; align-items: center; padding: 16px; margin-bottom: 12px; }
.list-info { display: flex; flex-direction: column; gap: 2px; }
.list-title { font-weight: 800; font-size: 0.95rem; }
.list-meta { font-size: 0.75rem; color: var(--text-light); font-weight: 700; }
.list-del-btn { border: none; background: #fee; color: #f66; width: 34px; height: 34px; border-radius: 10px; display: flex; align-items: center; justify-content: center; }

/* ===============================================
   ルール設定
   =============================================== */
.rule-card { padding: 18px; margin-bottom: 15px; }
.rule-card-header { display: flex; align-items: center; gap: 12px; }
.rule-name { flex: 1; font-weight: 800; font-size: 0.95rem; }
.expand-btn { background: #f0f4ff; border: none; color: var(--primary); width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; }

.rule-card-details { margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--border); }
.cycle-selector { display: flex; background: #f0f0f0; padding: 3px; border-radius: 8px; margin-bottom: 15px; }
.segment-btn { flex: 1; border: none; padding: 8px; border-radius: 6px; background: transparent; font-weight: 700; color: var(--text-light); font-size: 0.8rem; }
.segment-btn.active { background: white; color: var(--primary); box-shadow: 0 2px 4px rgba(0,0,0,0.05); }

.weekday-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 15px; }
.day-check { background: #f9f9f9; padding: 10px 5px; border-radius: 10px; text-align: center; border: 1px solid #eee; cursor: pointer; }
.day-check input { display: none; }
.day-check span { font-size: 0.8rem; font-weight: 800; color: var(--text-light); }
.day-check input:checked + span { color: var(--primary); }
.nth-row { display: flex; gap: 10px; margin-bottom: 15px; }

/* ===============================================
   システム設定
   =============================================== */
.setting-group-container { display: flex; flex-direction: column; gap: 20px; }
.setting-card { background: var(--card); border-radius: 24px; padding: 20px; box-shadow: var(--shadow); }
.header-title { display: flex; align-items: center; gap: 10px; }
.header-title h3 { margin: 0; font-size: 1rem; font-weight: 800; }
.location-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 10px; background: #f9f9f9; border-radius: 12px; margin-bottom: 8px; }
.loc-name-wrap { display: flex; align-items: center; gap: 8px; font-weight: 700; }
.loc-del-btn { border: none; background: transparent; color: #ccc; cursor: pointer; }
.add-text-btn { border: none; background: transparent; color: var(--primary); font-weight: 800; font-size: 0.85rem; display: flex; align-items: center; gap: 6px; padding: 8px 5px; cursor: pointer; }
.divider { height: 1px; background: var(--border); margin: 15px 0; }
.setting-row { display: flex; justify-content: space-between; align-items: center; }
.setting-info { display: flex; align-items: center; gap: 10px; font-weight: 800; }
.data-action-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
.tool-btn { background: #f9f9f9; border: none; border-radius: 20px; padding: 15px; display: flex; flex-direction: column; align-items: center; gap: 8px; cursor: pointer; transition: 0.2s; }
.icon-circle { width: 44px; height: 44px; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
.icon-circle.download { background: #eef4ff; color: #4a80ff; }
.icon-circle.upload { background: #fff0f0; color: #ff6b6b; }

/* 危険操作エリア（高度な設定） */
.danger-zone-wrapper {
    margin-top: 60px;
    padding: 0 10px;
    text-align: center;
    border-top: 1px dashed #ddd;
    padding-top: 30px;
}
.danger-btn-outline {
    background: transparent; border: 2px solid #ffcccc; color: #ff8888;
    border-radius: 16px; padding: 15px; width: 100%;
    display: flex; align-items: center; justify-content: center; gap: 10px;
    font-weight: 800; font-size: 0.9rem; cursor: pointer;
}

/* ===============================================
   汎用 & ナビゲーション
   =============================================== */
.primary-btn { width: 100%; padding: 16px; border: none; border-radius: 16px; background: var(--primary); color: white; font-weight: 800; cursor: pointer; }
input, select { width: 100%; padding: 12px; margin: 5px 0 15px; border-radius: 12px; border: 1px solid #eee; background: #fdfdfd; font-size: 1rem; font-weight: 700; outline: none; }
label { font-size: 0.8rem; font-weight: 800; color: var(--text-light); margin-left: 5px; }

.app-navigation { position: fixed; bottom: 0; width: 100%; background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); display: flex; justify-content: space-around; padding: 10px 0 30px; border-top: 1px solid #f0f0f0; z-index: 1000; }
.nav-item { border: none; background: none; color: #ccc; display: flex; flex-direction: column; align-items: center; gap: 4px; flex: 1; cursor: pointer; }
.nav-item.active { color: var(--primary); }
.nav-item span:last-child { font-size: 0.65rem; font-weight: 900; }

/* ダークモード補足 */
body.dark-mode { --bg: #121212; --card: #1e1e1e; --text: #f0f0f0; --border: #333333; }
body.dark-mode .app-header, body.dark-mode .app-navigation { background: rgba(30, 30, 30, 0.95); }
body.dark-mode input, body.dark-mode select, body.dark-mode .location-row, body.dark-mode .tool-btn, body.dark-mode .day-check { background: #2a2a2a; border-color: #333; color: white; }
body.dark-mode .location-switcher, body.dark-mode .sub-tabs { background: #2a2a2a; }
body.dark-mode .month-nav-btn { background: #1e1e1e; color: var(--primary); }